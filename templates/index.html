<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildfire Risk Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function fetchRiskCity() {
            const location = document.getElementById("location-city").value;

            fetch("/get_risk", {
                method: "POST",
                body: new URLSearchParams({ location }),
                headers: { "Content-Type": "application/x-www-form-urlencoded" }
            })
            .then(response => response.json())
            .then(data => displayResult(data, "Formula Risk"));
        }

        function fetchRiskCoordsML() {
            const lat = document.getElementById("latitude").value;
            const lon = document.getElementById("longitude").value;

            fetch(`/predict_risk_coords?lat=${lat}&lon=${lon}`, {
                method: "GET",
            })
            .then(response => response.json())
            .then(data => displayResult(data, "ML Predicted Risk"));
        }

        function fetchCombinedRisk() {
            const lat = document.getElementById("latitude").value;
            const lon = document.getElementById("longitude").value;

            fetch(`/combined_risk?lat=${lat}&lon=${lon}`, {
                method: "GET",
            })
            .then(response => response.json())
            .then(data => displayResult(data, "Combined Risk"));
        }

        function displayResult(data, riskType) {
            const resultDiv = document.getElementById("result");
            let riskValue;
            let additionalInfo = "";

            if (riskType === "Formula Risk" && data.risk_percentage !== undefined) {
                riskValue = data.risk_percentage;
                additionalInfo = `
                    <p class="mb-1"><strong> 🌍 Location:</strong> ${data.location}</p>
                    <p class="mb-1"><strong>📅 Date & Time:</strong> ${data.date_time}</p>
                    <p class="mb-1"><strong>🌡 Temperature:</strong> ${data.temperature}°C</p>
                    <p class="mb-1"><strong>💧 Humidity:</strong> ${data.humidity}%</p>
                    <p class="mb-1"><strong>💨 Wind Speed:</strong> ${data.wind_speed} km/h</p>
                `;
            } else if (riskType === "ML Predicted Risk" && data.predicted_fire_probability !== undefined) {
                riskValue = (data.predicted_fire_probability * 100).toFixed(2);
                additionalInfo = `
                    <p class="mb-1"><strong>📍 Latitude:</strong> ${data.latitude}</p>
                    <p class="mb-1"><strong>🗺️ Longitude:</strong> ${data.longitude}</p>
                    <p class="mb-1"><strong>🌡 Temperature:</strong> ${data.current_temperature_c}°C</p>
                    <p class="mb-1"><strong>💧 Humidity:</strong> ${data.current_humidity}%</p>
                    <p class="mb-1"><strong>💨 Wind Speed:</strong> ${data.current_wind_speed_kph} km/h</p>
                `;
            } else if (riskType === "Combined Risk" && data.combined_risk !== undefined) {
                riskValue = data.combined_risk;
                additionalInfo = `
                    <p class="mb-1"><strong>📍 Latitude:</strong> ${data.latitude}</p>
                    <p class="mb-1"><strong>🗺️ Longitude:</strong> ${data.longitude}</p>
                    <p class="mb-1"><strong>🌡 Temperature:</strong> ${data.current_temperature_c}°C</p>
                    <p class="mb-1"><strong>💧 Humidity:</strong> ${data.current_humidity}%</p>
                    <p class="mb-1"><strong>💨 Wind Speed:</strong> ${data.current_wind_speed_kph} km/h</p>
                    <p class="mb-1"><strong>📊 Formula Risk:</strong> ${data.formula_risk_percentage}%</p>
                    <p class="mb-1"><strong>🧠 ML Probability:</strong> ${(data.ml_predicted_probability * 100).toFixed(2)}%</p>
                `;
            } else {
                resultDiv.innerText = "❌ Error fetching data. Please try again.";
                return;
            }

            resultDiv.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md text-gray-700">
                    <p class="text-lg font-bold"><strong>🔥 Wildfire Risk (${riskType}):</strong> <span class="text-red-500">${riskValue}%</span></p>
                    ${additionalInfo}
                </div>
            `;
        }
    </script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-5">
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-gray-800 mb-4 text-center">🔥 Wildfire Risk Predictor</h1>
        <p class="text-gray-600 text-center mb-6">Enter a location (city or coordinates) to get the wildfire risk percentage.</p>

        <div>
            <h2 class="text-lg font-semibold text-gray-700 mb-2">By City (Formula-Based)</h2>
            <div class="flex gap-2 mb-4">
                <input type="text" id="location-city" placeholder="Enter City" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-400 outline-none">
                <button onclick="fetchRiskCity()" class="px-5 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-200">
                    Check Risk
                </button>
            </div>
        </div>

        <div>
            <h2 class="text-lg font-semibold text-gray-700 mb-2">By Coordinates (ML Prediction)</h2>
            <div class="grid grid-cols-2 gap-2 mb-4">
                <input type="text" id="latitude" placeholder="Latitude" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                <input type="text" id="longitude" placeholder="Longitude" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                <button onclick="fetchRiskCoordsML()" class="col-span-2 px-5 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition duration-200">
                    Check Risk (ML)
                </button>
            </div>
        </div>

        <div>
            <h2 class="text-lg font-semibold text-gray-700 mb-2">By Coordinates (Combined Risk)</h2>
            <div class="grid grid-cols-2 gap-2 mb-4">
                <input type="text" id="latitude-combined" placeholder="Latitude" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-400 outline-none">
                <input type="text" id="longitude-combined" placeholder="Longitude" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-400 outline-none">
                <button onclick="fetchCombinedRisk()" class="col-span-2 px-5 py-2 bg-purple-500 text-white font-semibold rounded-lg hover:bg-purple-600 transition duration-200">
                    Check Combined Risk
                </button>
            </div>
        </div>

        <div id="result" class="mt-6"></div>
    </div>
</body>
</html>